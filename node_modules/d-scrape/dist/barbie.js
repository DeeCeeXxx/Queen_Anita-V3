const axios = require('axios')
const FormData = require('form-data')
const fs = require('fs')

async function Barbie(url) {
    try {
        const formData = new FormData()
        const responses = await axios.get(url, { responseType: 'arraybuffer' })
        const file = Buffer.from(responses.data, 'binary')
        formData.append('myfile', file, { filename: 'dann.jpg' })

        const headers = {
            'Accept': 'application/json, text/plain, */*',
            'Accept-Encoding': 'gzip, deflate, br',
            'Accept-Language': 'en-US,en;q=0.9',
            'Content-Type': `multipart/form-data; boundary=${formData._boundary}`,
            'Cookie': '_ga=GA1.1.1739632469.1713271796; _ga_D0Z3WGG431=GS1.1.1713271796.1.1.1713271985.0.0.0',
            'Host': 'www.barbieselfie.ai',
            'Origin': 'https://www.barbieselfie.ai',
            'Referer': 'https://www.barbieselfie.ai/intl/step/loading/',
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36'
        }

        const response = await axios.post('https://www.barbieselfie.ai/api/upload.php', formData, {
            headers: {
                ...formData.getHeaders(),
                ...headers
            },
            maxContentLength: Infinity,
            maxBodyLength: Infinity
        })

        return response.data
    } catch (error) {
        console.error('Error:', error.response ? error.response.data : error.message)
        throw error
    }
}

module.exports = {
  Barbie
}